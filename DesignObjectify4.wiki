#summary API design for Objectify 4.0

= Design goals =
  * Use interfaces to hide asynchrony from client
  * Use Ref<?> when asynchrony cannot be hidden (ie, returning concrete classes)
  * Consistent interface for batch get vs filtering
  * Consistent interface for fetch groups
  * All intermediate command objects are immutable
  * Fix poor initial design decisions

= Cleanup =
  * Stop using JPA annotations
  * Convert all annotations to imperative form (eg @Index instead of @Indexed)
  * All fields default to not indexed

= Example of class with fetching =
{{{
class Beastie {
   @Fetch @Parent ParentThing parent;
   @Id Long id;

   @Fetch({"bigGroup", "smallGroup"}) SomeThing some;
   @Fetch("bigGroup") List<OtherThing> others;
   @Fetch Ref<OtherThing> refToOtherThing;
   Ref<OtherThing> anotherRef;  // this one is never fetched automatically
}
}}}

= The Ref class =
{{{
class Ref<T> {
    Key<T> getKey();
    T get();
    T getSafe() throws NotFoundException;
}
}}}

= API examples =
{{{
// Simple fetch of refs
ofy.find().refs(ref1, ref2);	// void

// Simple key fetch, always async
Ref<Thing> th = ofy.find().key(thingKey);
Thing th =      ofy.find().key(thingKey).get();
Thing th =      ofy.find().key(thingKey).getSafe();	// throws NotFoundException

// With a fetch group
Thing th = ofy.find().fetch("group").key(thingKey).get();

// Multi get is async, hides asynchrony behind Map interface
Map<Key<Thing>, Thing> ths = ofy.find().keys(123L, 456L);

// Fetching by id
Ref<Thing> th = ofy.find().type(Thing.class).id(123L);
Thing th =      ofy.find().type(Thing.class).id(123L).get();

// With a parent
Ref<Thing> th = ofy.find().type(Thing.class).parent(par).id(123L);

// Batch get, asynchrony is hidden behind Map
Map<Key<Thing>, Thing> ths = ofy.find().type(Thing.class).ids(123L, 456L);

// Queries (asynchrony hidden of course)
Iterable<Key<Thing>> ths =  ofy.find().type(Thing.class).filter("foo", foo).keys();
Iterable<Thing> ths =       ofy.find().type(Thing.class).filter("foo", foo).entities();

// Get first item
Ref<Key<Thing>> th = ofy.find().type(Thing.class).filter("foo", foo).key();
Key<Thing> th =      ofy.find().type(Thing.class).filter("foo", foo).key().get();
Key<Thing> th =      ofy.find().type(Thing.class).filter("foo", foo).key().getSafe();	// throws NotFoundException

Ref<Thing> th = ofy.find().type(Thing.class).filter("foo", foo).entity();
Thing th =      ofy.find().type(Thing.class).filter("foo", foo).entity().get();
Thing th =      ofy.find().type(Thing.class).filter("foo", foo).entity().getSafe();	// throws NotFoundException

// Query with fetch group
Iterable<Thing> ths = ofy.find().fetch("group").type(Thing.class).filter("foo", foo).entities();
}}}